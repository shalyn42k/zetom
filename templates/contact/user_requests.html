{% load static %}
<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if lang == 'pl' %}Moje zgłoszenia – ZETOM Katowice{% else %}My requests – ZETOM Katowice{% endif %}</title>
    <link rel="shortcut icon" href="{% static 'img/zet1.png' %}" type="image/png">
    <link rel="stylesheet" href="{% static 'css/public.css' %}">
</head>
<body class="requests-page">
<header class="site-header">
    <a href="{% url 'contact:login' %}?lang={{ lang }}" class="site-branding" title="{% if lang == 'pl' %}Panel administratora{% else %}Admin panel{% endif %}" aria-label="{% if lang == 'pl' %}Panel administratora{% else %}Admin panel{% endif %}">
        <img src="{% static 'img/zet3.avif' %}" alt="ZETOM Katowice" class="site-logo">
        <div>
            <h1 class="site-title">ZETOM Katowice</h1>
            <p class="site-subtitle">{% if lang == 'pl' %}Badania • Certyfikacja • Kontrola techniczna{% else %}Testing • Certification • Technical inspections{% endif %}</p>
        </div>
    </a>
    <nav class="site-nav">
        <a href="{% url 'contact:index' %}?lang={{ lang }}">{% if lang == 'pl' %}Strona główna{% else %}Home{% endif %}</a>
        <a href="{% url 'contact:user_requests' %}?lang={{ lang }}" class="is-active">{% if lang == 'pl' %}Moje zgłoszenia{% else %}My requests{% endif %}</a>
    </nav>
    <div class="site-header__actions">
        <div class="lang-switcher">
            <a href="{% url 'contact:user_requests' %}?lang=pl" class="{% if lang == 'pl' %}is-active{% endif %}">PL</a>
            <a href="{% url 'contact:user_requests' %}?lang=en" class="{% if lang != 'pl' %}is-active{% endif %}">EN</a>
        </div>
    </div>
</header>

<main class="requests-main">
    <section class="section">
        <div class="section-header">
            <h2 class="section-title">{% if lang == 'pl' %}Twoje zgłoszenia{% else %}Your requests{% endif %}</h2>
            <p class="section-text">{{ update_hint }}</p>
        </div>

        {% if messages %}
            <div class="message-list">
                {% for msg in messages %}
                    {% with tags=msg.tags %}
                        <div class="alert {% if 'success' in tags %}alert-success{% elif 'error' in tags or 'warning' in tags %}alert-error{% else %}alert-success{% endif %}">
                            {{ msg }}
                        </div>
                    {% endwith %}
                {% endfor %}
            </div>
        {% endif %}

        {% if has_messages %}
            <div class="requests-list">
                {% for entry in entries %}
                    <article class="request-card">
                        <header class="request-card__header">
                            <div class="request-card__meta">
                                <span class="request-card__id">#{{ entry.message.id }}</span>
                                <span class="badge {{ entry.status_badge }}">{{ entry.status_label }}</span>
                            </div>
                            <div class="request-card__date">{{ entry.message.created_at|date:'Y-m-d H:i' }}</div>
                        </header>
                        <div class="request-card__body">
                            <form method="post" action="{% url 'contact:user_requests' %}?lang={{ lang }}" class="request-card__form">
                                {% csrf_token %}
                                <input type="hidden" name="message_id" value="{{ entry.message.id }}">
                                <input type="hidden" name="form_prefix" value="{{ entry.form.prefix }}">
                                {% if entry.form.non_field_errors %}
                                    <div class="form-error">{{ entry.form.non_field_errors.0 }}</div>
                                {% endif %}
                                <div class="form-grid form-grid--compact">
                                    <div class="form-field">
                                        <label for="{{ entry.form.first_name.id_for_label }}" class="form-label">{% if lang == 'pl' %}Imię{% else %}First name{% endif %}</label>
                                        {{ entry.form.first_name }}
                                        {% if entry.form.first_name.errors %}<div class="form-error">{{ entry.form.first_name.errors.0 }}</div>{% endif %}
                                    </div>
                                    <div class="form-field">
                                        <label for="{{ entry.form.last_name.id_for_label }}" class="form-label">{% if lang == 'pl' %}Nazwisko{% else %}Last name{% endif %}</label>
                                        {{ entry.form.last_name }}
                                        {% if entry.form.last_name.errors %}<div class="form-error">{{ entry.form.last_name.errors.0 }}</div>{% endif %}
                                    </div>
                                    <div class="form-field">
                                        <label for="{{ entry.form.phone.id_for_label }}" class="form-label">{% if lang == 'pl' %}Telefon{% else %}Phone{% endif %}</label>
                                        {{ entry.form.phone }}
                                        {% if entry.form.phone.errors %}<div class="form-error">{{ entry.form.phone.errors.0 }}</div>{% endif %}
                                    </div>
                                    <div class="form-field">
                                        <label for="{{ entry.form.email.id_for_label }}" class="form-label">E-mail</label>
                                        {{ entry.form.email }}
                                        {% if entry.form.email.errors %}<div class="form-error">{{ entry.form.email.errors.0 }}</div>{% endif %}
                                    </div>
                                    <div class="form-field">
                                        <label for="{{ entry.form.company.id_for_label }}" class="form-label">{% if lang == 'pl' %}Firma{% else %}Company{% endif %}</label>
                                        {{ entry.form.company }}
                                        {% if entry.form.company.errors %}<div class="form-error">{{ entry.form.company.errors.0 }}</div>{% endif %}
                                    </div>
                                    <div class="form-field" style="grid-column: 1 / -1;">
                                        <label for="{{ entry.form.message.id_for_label }}" class="form-label">{% if lang == 'pl' %}Treść zgłoszenia{% else %}Request details{% endif %}</label>
                                        {{ entry.form.message }}
                                        {% if entry.form.message.errors %}<div class="form-error">{{ entry.form.message.errors.0 }}</div>{% endif %}
                                    </div>
                                </div>
                                <div class="request-card__footer">
                                    <span class="request-card__status-label">{% if lang == 'pl' %}Status:{% else %}Status:{% endif %}</span>
                                    <span class="badge {{ entry.status_badge }}">{{ entry.status_label }}</span>
                                    <button type="submit" class="button button--primary request-card__submit">
                                        {% if lang == 'pl' %}Zapisz zmiany{% else %}Save changes{% endif %}
                                    </button>
                                </div>
                            </form>
                        </div>
                    </article>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <h3 class="empty-state__title">{{ empty_state_title }}</h3>
                <p class="empty-state__text">{{ empty_state_text }}</p>
                <a href="{% url 'contact:index' %}?lang={{ lang }}" class="button button--primary empty-state__action">
                    {% if lang == 'pl' %}Przejdź do formularza{% else %}Go to the form{% endif %}
                </a>
            </div>
        {% endif %}
    </section>
</main>

<footer class="site-footer">
    <p>© {% now 'Y' %} ZETOM Katowice</p>
</footer>
</body>
</html>

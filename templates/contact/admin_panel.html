{% load static %}
<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if lang == 'pl' %}Panel administracyjny{% else %}Admin panel{% endif %}</title>
    <link rel="shortcut icon" href="{% static 'img/zet1.png' %}" type="image/png">
    <link rel="stylesheet" href="{% static 'css/admin.css' %}">
    <script src="{% static 'js/admin.js' %}" defer></script>
</head>
<body{% if trash_form.errors %} class="has-modal"{% endif %}>
<div class="overlay"></div>
<div class="modal{% if trash_form.errors %} is-visible{% endif %}" data-trash-modal aria-hidden="{% if trash_form.errors %}false{% else %}true{% endif %}">
    <div class="modal__backdrop" data-trash-close></div>
    <div class="modal__dialog" role="dialog" aria-modal="true" aria-labelledby="trash-title">
        <button type="button" class="modal__close" data-trash-close aria-label="{% if lang == 'pl' %}Zamknij kosz{% else %}Close trash{% endif %}">×</button>
        <h2 class="modal__title" id="trash-title">{% if lang == 'pl' %}Kosz{% else %}Trash{% endif %}</h2>
        <form method="post" class="modal__form" data-trash-form>
            {% csrf_token %}
            {{ trash_form.form_name }}
            {{ trash_form.action }}
            <div class="modal__toolbar">
                <label class="checkbox-pill">
                    <input type="checkbox" data-trash-select-all {% if not deleted_messages %}disabled{% endif %}>
                    <span>{% if lang == 'pl' %}Zaznacz wszystkie{% else %}Select all{% endif %}</span>
                </label>
                {% if trash_form.non_field_errors %}
                    <div class="form-error form-error--inline">{{ trash_form.non_field_errors.0 }}</div>
                {% endif %}
            </div>
            <div class="trash-list" data-trash-list>
                {% for message_item in deleted_messages %}
                    <label class="trash-item">
                        <input type="checkbox"
                               name="selected"
                               value="{{ message_item.id }}"
                               class="trash-item__checkbox"
                               data-trash-row>
                        <span class="trash-item__content">
                            <span class="trash-item__meta">#{{ message_item.id }} · {{ message_item.email }}</span>
                            <span class="trash-item__preview">{{ message_item.message|truncatechars:120 }}</span>
                        </span>
                        <span class="trash-item__date">{{ message_item.created_at|date:'Y-m-d H:i' }}</span>
                    </label>
                {% empty %}
                    <p class="trash-empty">{% if lang == 'pl' %}Kosz jest pusty.{% else %}Trash is empty.{% endif %}</p>
                {% endfor %}
            </div>
            <div class="modal__actions">
                <button type="submit"
                        class="button button--success"
                        data-trash-action
                        data-trash-action-value="restore"
                        data-requires-selection="true"
                        {% if not deleted_messages %}disabled{% endif %}>
                    {% if lang == 'pl' %}Przywróć zaznaczone{% else %}Restore selected{% endif %}
                </button>
                <button type="submit"
                        class="button button--danger"
                        data-trash-action
                        data-trash-action-value="delete"
                        data-requires-selection="true"
                        {% if not deleted_messages %}disabled{% endif %}>
                    {% if lang == 'pl' %}Usuń zaznaczone{% else %}Delete selected{% endif %}
                </button>
                <button type="submit"
                        class="button button--outline"
                        data-trash-action
                        data-trash-action-value="empty"
                        data-requires-selection="false"
                        {% if not deleted_messages %}disabled{% endif %}>
                    {% if lang == 'pl' %}Opróżnij kosz{% else %}Empty trash{% endif %}
                </button>
            </div>
        </form>
    </div>
</div>
<header class="topbar">
    <div class="topbar-left">
        <img src="{% static 'img/zet3.avif' %}" alt="ZETOM" class="topbar-logo">
        <div>
            <h1 class="topbar-title">{% if lang == 'pl' %}Panel administracyjny{% else %}Admin panel{% endif %}</h1>
            <p class="site-subtitle">{% if lang == 'pl' %}Zarządzaj wiadomościami od klientów{% else %}Manage customer enquiries{% endif %}</p>
        </div>
    </div>
    <nav class="topbar-nav">
        <a class="nav-link" href="{% url 'contact:index' %}?lang={{ lang }}">{% if lang == 'pl' %}Strona główna{% else %}Website{% endif %}</a>
        <a class="nav-link" href="?lang=pl">PL</a>
        <a class="nav-link" href="?lang=en">EN</a>
        <form method="post" action="{% url 'contact:logout' %}?lang={{ lang }}">
            {% csrf_token %}
            <button type="submit" class="nav-button">{% if lang == 'pl' %}Wyloguj{% else %}Log out{% endif %}</button>
        </form>
    </nav>
</header>

<main class="main">
    {% if messages %}
        <div class="alerts">
            {% for msg in messages %}
                {% with tags=msg.tags %}
                    <div class="alert {% if 'success' in tags %}alert-success{% elif 'error' in tags or 'warning' in tags %}alert-error{% else %}alert-success{% endif %}">
                        {{ msg }}
                    </div>
                {% endwith %}
            {% endfor %}
        </div>
    {% endif %}

    <section class="panel">
        <h2>{% if lang == 'pl' %}Zgłoszenia kontaktowe{% else %}Contact messages{% endif %}</h2>
        <form method="post"
              class="panel-form"
              data-bulk-form
              data-empty-selection="{% if lang == 'pl' %}Wybierz co najmniej jedną wiadomość.{% else %}Select at least one message.{% endif %}">
            {% csrf_token %}
            <input type="hidden" name="form_name" value="bulk">
            <div class="panel-form-row">
                <div class="panel-form-field">
                    <label for="{{ action_form.action.id_for_label }}" class="form-label">{% if lang == 'pl' %}Akcja{% else %}Action{% endif %}</label>
                    {{ action_form.action }}
                    {% if action_form.action.errors %}<div class="form-error">{{ action_form.action.errors.0 }}</div>{% endif %}
                </div>
                <div class="panel-form-actions">
                    <button type="submit" class="button button--primary button--compact" data-bulk-submit>
                        {% if lang == 'pl' %}Wykonaj{% else %}Apply{% endif %}
                    </button>
                    <button type="button" class="button button--ghost button--compact button--trash" data-trash-open>
                        {% if lang == 'pl' %}Kosz{% else %}Trash{% endif %}
                    </button>
                </div>
            </div>
            {% if action_form.selected.errors %}
                <div class="form-error">{{ action_form.selected.errors.0 }}</div>
            {% endif %}

            <div class="table-wrapper">
                <table class="table">
                    <thead>
                    <tr>
                        <th><input type="checkbox" class="table-checkbox" data-select-all aria-label="{% if lang == 'pl' %}Zaznacz wszystkie{% else %}Select all{% endif %}"></th>
                        <th>ID</th>
                        <th>{% if lang == 'pl' %}Data{% else %}Date{% endif %}</th>
                        <th>{% if lang == 'pl' %}Klient{% else %}Customer{% endif %}</th>
                        <th>{% if lang == 'pl' %}Telefon{% else %}Phone{% endif %}</th>
                        <th>E-mail</th>
                        <th>{% if lang == 'pl' %}Firma{% else %}Company{% endif %}</th>
                        <th>{% if lang == 'pl' %}Treść{% else %}Message{% endif %}</th>
                        <th>{% if lang == 'pl' %}Status{% else %}Status{% endif %}</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for message_item in messages_list %}
                        <tr>
                            <td>
                                <input type="checkbox"
                                       name="selected"
                                       value="{{ message_item.id }}"
                                       class="table-checkbox"
                                       data-row-checkbox
                                       aria-label="{% if lang == 'pl' %}Zaznacz wiadomość o ID {{ message_item.id }}{% else %}Select message with ID {{ message_item.id }}{% endif %}">
                            </td>
                            <td>#{{ message_item.id }}</td>
                            <td>{{ message_item.created_at|date:'Y-m-d H:i' }}</td>
                            <td>{{ message_item.first_name }} {{ message_item.last_name }}</td>
                            <td><a href="tel:{{ message_item.phone }}">{{ message_item.phone }}</a></td>
                            <td><a href="mailto:{{ message_item.email }}">{{ message_item.email }}</a></td>
                            <td>{{ message_item.company }}</td>
                            <td>{{ message_item.message|linebreaksbr }}</td>
                            <td>
                                {% if message_item.status == message_item.STATUS_NEW %}
                                    <span class="badge badge--success">{% if lang == 'pl' %}Nowe{% else %}New{% endif %}</span>
                                {% elif message_item.status == message_item.STATUS_IN_PROGRESS %}
                                    <span class="badge badge--warning">{% if lang == 'pl' %}W trakcie{% else %}In progress{% endif %}</span>
                                {% else %}
                                    <span class="badge badge--info">{% if lang == 'pl' %}Gotowe{% else %}Ready{% endif %}</span>
                                {% endif %}
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="9" class="empty-state">{% if lang == 'pl' %}Brak wiadomości.{% else %}No messages yet.{% endif %}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </form>
    </section>

    <section class="email-card">
        <h2>{% if lang == 'pl' %}Wyślij wiadomość do klienta{% else %}Send an email to a customer{% endif %}</h2>
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" name="send_email" value="1">
            {% if email_form.non_field_errors %}
                <div class="form-error">{{ email_form.non_field_errors.0 }}</div>
            {% endif %}
            <div class="email-grid">
                <div>
                    <label for="{{ email_form.to_email.id_for_label }}" class="form-label">E-mail</label>
                    {{ email_form.to_email }}
                    {% if email_form.to_email.errors %}<div class="form-error">{{ email_form.to_email.errors.0 }}</div>{% endif %}
                </div>
                <div>
                    <label for="{{ email_form.subject.id_for_label }}" class="form-label">{% if lang == 'pl' %}Temat{% else %}Subject{% endif %}</label>
                    {{ email_form.subject }}
                    {% if email_form.subject.errors %}<div class="form-error">{{ email_form.subject.errors.0 }}</div>{% endif %}
                </div>
                <div style="grid-column: 1 / -1;">
                    <label for="{{ email_form.body.id_for_label }}" class="form-label">{% if lang == 'pl' %}Treść{% else %}Message{% endif %}</label>
                    {{ email_form.body }}
                    {% if email_form.body.errors %}<div class="form-error">{{ email_form.body.errors.0 }}</div>{% endif %}
                </div>
                <div>
                    <label for="{{ email_form.attachment.id_for_label }}" class="form-label">{% if lang == 'pl' %}Załącznik (opcjonalnie){% else %}Attachment (optional){% endif %}</label>
                    {{ email_form.attachment }}
                    {% if email_form.attachment.errors %}<div class="form-error">{{ email_form.attachment.errors.0 }}</div>{% endif %}
                </div>
            </div>
            <button type="submit" class="form-submit">{% if lang == 'pl' %}Wyślij e-mail{% else %}Send email{% endif %}</button>
        </form>
    </section>
</main>
</body>
</html>

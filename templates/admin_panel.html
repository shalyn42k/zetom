<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8">
    <title>{% if lang == 'pl' %}Panel Admina{% else %}Admin Panel{% endif %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        :root {
            --green:#2fa84f;
            --green-dark:#23863d;
            --white:#ffffff;
            --text:#000000;
        }

        html, body {
            height: 100%;
            margin: 0;
            background: linear-gradient(180deg, #f6fff6 0%, #ffffff 100%);
            color: var(--text);
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
        }

        body {
            display: flex;
            flex-direction: column;
        }

        .container-fluid {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
            padding: 20px;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .table thead th {
            background: linear-gradient(90deg,var(--green),var(--green-dark));
            color: #fff;
            text-align: center;
        }

        .table tbody tr {
            cursor: pointer;
            background: #fff;
        }

        .table tbody tr:hover {
            background: rgba(47,168,79,0.07);
        }

        .btn-send {
            background: var(--green);
            color: #fff;
        }

        .btn-send:hover {
            background: var(--green-dark);
        }

        .status-badge {
            font-size: 0.85rem;
            font-weight: 600;
            border-radius: 8px;
            padding: 6px 12px;
            cursor: pointer;
            display: inline-block;
        }

        .status-unread { background: #dc3545; color:#fff; }
        .status-inreview { background: #ffc107; color:#000; }
        .status-read { background: #28a745; color:#fff; }

        .table-responsive {
            flex: 1;
            overflow-y: auto;
            overflow-x: auto;
        }

        .modal-fullscreen .modal-content {
            border-radius: 0;
        }

        .recycle-bin {
            background: var(--green-dark);
            color: #fff;
            border: none;
        }
        .recycle-bin:hover { background: var(--green); }
    </style>
</head>
<body>

<div class="container-fluid">

    <div class="top-bar">
        <div class="d-flex gap-2">
            <button class="btn btn-sm btn-outline-secondary" onclick="toggleLang()">üåê</button>
            <button class="btn btn-sm recycle-bin" onclick="toggleRecycle()">{% if lang == 'pl' %}üóë Kosz{% else %}üóë Recycle Bin{% endif %}</button>
        </div>
        <a href="{{ url_for('routes.logout') }}" class="btn btn-danger">{% if lang == 'pl' %}Wyloguj{% else %}Logout{% endif %}</a>
    </div>

    <h3 class="text-center mb-3">{% if lang == 'pl' %}Panel Admina{% else %}Admin Panel{% endif %}</h3>

    <div class="table-responsive" id="mainTable">
        <table class="table table-borderless text-center align-middle">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>{% if lang == 'pl' %}Data{% else %}Date{% endif %}</th>
                    <th>{% if lang == 'pl' %}Klient{% else %}Client{% endif %}</th>
                    <th>Telefon</th>
                    <th>Email</th>
                    <th>{% if lang == 'pl' %}Firma{% else %}Company{% endif %}</th>
                    <th>{% if lang == 'pl' %}Tre≈õƒá{% else %}Message{% endif %}</th>
                    <th>Status</th>
                    <th>{% if lang == 'pl' %}Akcje{% else %}Actions{% endif %}</th>
                </tr>
            </thead>
            <tbody id="inquiryList">
                {% for inquiry in inquiries %}
                <tr data-id="{{ inquiry.id }}" data-email="{{ inquiry.email }}" data-name="{{ inquiry.imie }} {{ inquiry.nazwisko }}" data-date="{{ inquiry.created_at.strftime('%Y-%m-%d %H:%M') }}" data-message="{{ inquiry.tresc_wiadomosci|e }}" data-phone="{{ inquiry.telefon }}" data-company="{{ inquiry.firma }}">
                    <td>{{ inquiry.id }}</td>
                    <td>{{ inquiry.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                    <td>{{ inquiry.imie }} {{ inquiry.nazwisko }}</td>
                    <td>{{ inquiry.telefon }}</td>
                    <td>{{ inquiry.email }}</td>
                    <td>{{ inquiry.firma }}</td>
                    <td>{{ inquiry.tresc_wiadomosci[:50] }}{% if inquiry.tresc_wiadomosci|length > 50 %}...{% endif %}</td>
                    <td><span class="status-badge status-unread" onclick="toggleStatus(this)">{% if lang == 'pl' %}Nieprzeczytane{% else %}Unread{% endif %}</span></td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="openDetail(this)">{% if lang == 'pl' %}Rozwi≈Ñ{% else %}View{% endif %}</button>
                        <button class="btn btn-sm btn-send" onclick="openGmail(this)">{% if lang == 'pl' %}E-mail{% else %}E-mail{% endif %}</button>
                        <button class="btn btn-sm btn-outline-danger" onclick="moveToRecycle(this)">{% if lang == 'pl' %}Usu≈Ñ{% else %}Delete{% endif %}</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- –ö–æ—Ä–∑–∏–Ω–∞ -->
    <div class="table-responsive" id="recycleBin" style="display:none;">
        <h5 class="text-center text-danger mb-3">{% if lang == 'pl' %}Kosz{% else %}Recycle Bin{% endif %}</h5>
        <table class="table text-center">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>{% if lang == 'pl' %}Klient{% else %}Client{% endif %}</th>
                    <th>Email</th>
                    <th>{% if lang == 'pl' %}Akcje{% else %}Actions{% endif %}</th>
                </tr>
            </thead>
            <tbody id="binList"></tbody>
        </table>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ -->
<div class="modal fade modal-fullscreen" id="detailModal" tabindex="-1">
  <div class="modal-dialog modal-fullscreen">
    <div class="modal-content">
      <div class="modal-header" style="background:linear-gradient(90deg,var(--green),var(--green-dark)); color:#fff;">
        <h5 class="modal-title" id="detailTitle"></h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p><strong>ID:</strong> <span id="detailId"></span></p>
        <p><strong>{% if lang == 'pl' %}Data{% else %}Date{% endif %}:</strong> <span id="detailDate"></span></p>
        <p><strong>{% if lang == 'pl' %}Klient{% else %}Client{% endif %}:</strong> <span id="detailName"></span></p>
        <p><strong>Telefon:</strong> <span id="detailPhone"></span></p>
        <p><strong>Email:</strong> <span id="detailEmail"></span></p>
        <p><strong>{% if lang == 'pl' %}Firma{% else %}Company{% endif %}:</strong> <span id="detailCompany"></span></p>
        <p><strong>{% if lang == 'pl' %}Tre≈õƒá{% else %}Message{% endif %}:</strong></p>
        <pre id="detailMessage" style="white-space: pre-wrap;"></pre>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
let recycle = [];

function toggleLang() {
    const currentLang = "{{ lang }}";
    window.location.href = "?lang=" + (currentLang === "pl" ? "eng" : "pl");
}

function openDetail(btn) {
    const row = btn.closest("tr");
    document.getElementById("detailTitle").innerText = "Zg≈Çoszenie #" + row.dataset.id;
    document.getElementById("detailId").innerText = row.dataset.id;
    document.getElementById("detailDate").innerText = row.dataset.date;
    document.getElementById("detailName").innerText = row.dataset.name;
    document.getElementById("detailPhone").innerText = row.dataset.phone;
    document.getElementById("detailEmail").innerText = row.dataset.email;
    document.getElementById("detailCompany").innerText = row.dataset.company;
    document.getElementById("detailMessage").innerText = row.dataset.message;
    new bootstrap.Modal("#detailModal").show();
}

function openGmail(btn) {
    const email = btn.closest("tr").dataset.email;
    const subject = encodeURIComponent("Re: Inquiry");
    const body = encodeURIComponent("Dzie≈Ñ dobry / Hello,\n\n");
    window.open(`https://mail.google.com/mail/?view=cm&fs=1&to=${email}&su=${subject}&body=${body}`, "_blank");
}

function toggleStatus(el) {
    const lang = "{{ lang }}";
    if (el.classList.contains("status-unread")) {
        el.className = "status-badge status-inreview";
        el.textContent = lang === "pl" ? "W przeglƒÖdzie" : "In review";
    } else if (el.classList.contains("status-inreview")) {
        el.className = "status-badge status-read";
        el.textContent = lang === "pl" ? "Przeczytane" : "Read";
    } else {
        el.className = "status-badge status-unread";
        el.textContent = lang === "pl" ? "Nieprzeczytane" : "Unread";
    }
}

// –ö–æ—Ä–∑–∏–Ω–∞
function moveToRecycle(btn) {
    const row = btn.closest("tr");
    recycle.push(row.outerHTML);
    row.remove();
}

function toggleRecycle() {
    const main = document.getElementById("mainTable");
    const bin = document.getElementById("recycleBin");
    const list = document.getElementById("binList");
    if (bin.style.display === "none") {
        list.innerHTML = recycle.map(html => {
            const temp = document.createElement("tbody");
            temp.innerHTML = html;
            const tr = temp.querySelector("tr");
            return `<tr>
                <td>${tr.dataset.id}</td>
                <td>${tr.dataset.name}</td>
                <td>${tr.dataset.email}</td>
                <td><button class='btn btn-sm btn-success' onclick='restore(${tr.dataset.id})'>Restore</button></td>
            </tr>`;
        }).join("");
        bin.style.display = "block";
        main.style.display = "none";
    } else {
        bin.style.display = "none";
        main.style.display = "block";
    }
}

function restore(id) {
    const index = recycle.findIndex(html => html.includes(`data-id="${id}"`));
    if (index !== -1) {
        document.getElementById("inquiryList").insertAdjacentHTML("beforeend", recycle[index]);
        recycle.splice(index, 1);
        toggleRecycle();
        toggleRecycle();
    }
}
</script>

</body>
</html>
